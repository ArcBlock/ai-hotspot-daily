<!DOCTYPE html>
<html lang="en" data-theme="light" data-lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{meta.date}} - {{zh.title}}</title>
<meta name="description" content="{{en.tldr}}">
<meta property="og:title" content="{{en.title}}">
<meta property="og:description" content="{{en.tldr_short}}">
<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:locale:alternate" content="zh_CN">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{en.title}}">
<meta name="twitter:description" content="{{en.tldr_short}}">
<style>
:root {
  --bg: #ffffff;
  --bg-secondary: #f7f8fa;
  --bg-card: #ffffff;
  --text: #1a1a2e;
  --text-secondary: #555770;
  --text-muted: #8b8ca7;
  --border: #e4e5f1;
  --accent: #2563eb;
  --accent-light: #dbeafe;
  --success: #059669;
  --success-light: #d1fae5;
  --warning: #d97706;
  --warning-light: #fef3c7;
  --danger: #dc2626;
  --danger-light: #fee2e2;
  --impact-high: #dc2626;
  --impact-medium: #d97706;
  --impact-low: #059669;
  --radius: 12px;
  --shadow: 0 1px 3px rgba(0,0,0,0.08);
  --shadow-lg: 0 4px 12px rgba(0,0,0,0.1);
  --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans SC", sans-serif;
  --font-mono: "SF Mono", "Fira Code", monospace;
  --max-width: 720px;
}

[data-theme="dark"] {
  --bg: #0f172a;
  --bg-secondary: #1e293b;
  --bg-card: #1e293b;
  --text: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --border: #334155;
  --accent: #3b82f6;
  --accent-light: #1e3a5f;
  --success: #10b981;
  --success-light: #064e3b;
  --warning: #f59e0b;
  --warning-light: #78350f;
  --danger: #ef4444;
  --danger-light: #7f1d1d;
  --shadow: 0 1px 3px rgba(0,0,0,0.3);
  --shadow-lg: 0 4px 12px rgba(0,0,0,0.4);
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: var(--font-sans);
  background: var(--bg);
  color: var(--text);
  line-height: 1.7;
  -webkit-font-smoothing: antialiased;
}

.container { max-width: var(--max-width); margin: 0 auto; padding: 24px 16px 80px; }

/* Header & Controls */
.header { margin-bottom: 32px; }
.hero {
  background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg) 100%);
  border: 1px solid var(--border); border-radius: var(--radius);
  padding: 28px 24px 20px; margin-bottom: 24px;
}
.hero-brand {
  display: flex; align-items: center; justify-content: space-between;
  font-size: 12px; color: var(--text-muted); margin-bottom: 16px;
  text-transform: uppercase; letter-spacing: 0.08em; font-weight: 600;
}
.hero-brand-name { display: flex; align-items: center; gap: 6px; }
.hero-body { display: flex; gap: 20px; align-items: flex-start; }
.hero-content { flex: 1; }
.hero-content h1 { font-size: 24px; margin-bottom: 6px; }
.hero-content .subtitle { font-size: 15px; margin-bottom: 10px; }
.hero-content .tldr { font-size: 14px; margin-bottom: 0; padding: 10px 14px; }
.hero-side {
  flex-shrink: 0; display: flex; flex-direction: column; align-items: center; gap: 12px;
  padding: 12px 16px; border-left: 1px solid var(--border); min-width: 100px;
}
.hero-side .confidence-ring { width: 56px; height: 56px; }
.hero-side .confidence-ring svg { width: 56px; height: 56px; }
.hero-side .confidence-ring .ring-text { font-size: 14px; }
.hero-side .confidence-ring circle { stroke-width: 2.5; }
.hero-side .confidence-label { font-size: 11px; text-transform: uppercase; font-weight: 700; letter-spacing: 0.06em; }
.hero-mini-metrics { font-size: 12px; text-align: center; }
.hero-mini-metrics .mini-row { display: flex; justify-content: center; gap: 12px; margin-bottom: 4px; }
.hero-mini-metrics .mini-val { font-weight: 700; color: var(--text); }
.hero-mini-metrics .mini-label { color: var(--text-muted); }
.hero-cta {
  text-align: center; margin-top: 12px; padding-top: 12px;
  border-top: 1px solid var(--border); font-size: 12px; color: var(--text-muted);
}
@media (max-width: 640px) {
  .hero-body { flex-direction: column; }
  .hero-side { border-left: none; border-top: 1px solid var(--border); flex-direction: row; width: 100%; padding: 12px 0 0; }
  .hero-content h1 { font-size: 20px; }
}
.controls {
  display: flex; gap: 8px; justify-content: flex-end; margin-bottom: 20px;
  position: sticky; top: 0; z-index: 100; background: var(--bg);
  padding: 12px 0; border-bottom: 1px solid var(--border);
}
.toggle-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 6px 14px; border-radius: 20px;
  border: 1px solid var(--border); background: var(--bg-card);
  color: var(--text-secondary); font-size: 13px; cursor: pointer;
  transition: all 0.2s;
}
.toggle-btn:hover { border-color: var(--accent); color: var(--accent); }
.toggle-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

/* Meta */
.meta-bar {
  display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
  font-size: 13px; color: var(--text-muted); margin-bottom: 12px;
}
.meta-bar .date { font-weight: 600; color: var(--text-secondary); }

/* Confidence */
.confidence {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;
}
.confidence.high { background: var(--success-light); color: var(--success); }
.confidence.medium { background: var(--warning-light); color: var(--warning); }
.confidence.low { background: var(--danger-light); color: var(--danger); }
.confidence-ring { position: relative; width: 36px; height: 36px; }
.confidence-ring svg { transform: rotate(-90deg); }
.confidence-ring circle { fill: none; stroke-width: 3; }
.confidence-ring .ring-bg { stroke: var(--border); }
.confidence-ring .ring-fill {
  stroke: currentColor; stroke-linecap: round;
  stroke-dasharray: 94.25; /* 2 * PI * 15 */
  stroke-dashoffset: 94.25;
  transition: stroke-dashoffset 1.2s ease-out;
}
.confidence-ring .ring-text {
  position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 700;
}
.confidence-tooltip {
  display: none; position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%);
  background: var(--text); color: var(--bg); padding: 6px 10px; border-radius: 6px;
  font-size: 11px; font-weight: 400; white-space: nowrap; z-index: 10;
  pointer-events: none;
}
.confidence-tooltip::after {
  content: ""; position: absolute; top: 100%; left: 50%; transform: translateX(-50%);
  border: 4px solid transparent; border-top-color: var(--text);
}
.confidence:hover .confidence-tooltip { display: block; }
.confidence-bar {
  width: 48px; height: 4px; border-radius: 2px; background: var(--border); overflow: hidden;
}
.confidence-bar-fill { height: 100%; border-radius: 2px; transition: width 0.3s; }

/* Title */
h1 {
  font-size: 28px; line-height: 1.3; font-weight: 700;
  letter-spacing: -0.02em; margin-bottom: 8px;
}
.tldr {
  font-size: 17px; color: var(--text-secondary); line-height: 1.6;
  padding: 12px 16px; border-left: 3px solid var(--accent);
  background: var(--bg-secondary); border-radius: 0 var(--radius) var(--radius) 0;
  margin-bottom: 32px;
}

/* Section */
.section { margin-bottom: 28px; }
.section-title {
  font-size: 13px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 0.08em; color: var(--text-muted);
  margin-bottom: 12px; display: flex; align-items: center; gap: 8px;
}
.section-title::after {
  content: ""; flex: 1; height: 1px; background: var(--border);
}

/* Card */
.card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow);
  margin-bottom: 12px;
}
.card-content { color: var(--text-secondary); font-size: 15px; }
.card-content p { margin-bottom: 8px; }
.card-content strong { color: var(--text); }
.card-content a { color: var(--accent); text-decoration: none; }
.card-content a:hover { text-decoration: underline; }

/* Affected Groups */
.group-list { display: flex; flex-direction: column; gap: 10px; }
.group-item {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 12px 16px; border-radius: 8px; background: var(--bg-secondary);
}
.impact-badge {
  font-size: 11px; font-weight: 700; text-transform: uppercase;
  padding: 2px 8px; border-radius: 4px; white-space: nowrap; margin-top: 2px;
}
.impact-badge.high { background: var(--danger-light); color: var(--impact-high); }
.impact-badge.medium { background: var(--warning-light); color: var(--impact-medium); }
.impact-badge.low { background: var(--success-light); color: var(--impact-low); }
.group-info { flex: 1; }
.group-name { font-weight: 600; font-size: 14px; margin-bottom: 2px; }
.group-desc { font-size: 13px; color: var(--text-secondary); }

/* Action List */
.action-group { margin-bottom: 16px; }
.action-label {
  font-size: 12px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 0.06em; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;
}
.action-label.immediate { color: var(--danger); }
.action-label.this-week { color: var(--warning); }
.action-label.watch { color: var(--text-muted); }
.action-list { list-style: none; }
.action-item {
  display: flex; align-items: flex-start; gap: 8px;
  padding: 8px 12px; border-radius: 8px; font-size: 14px;
  margin-bottom: 4px; background: var(--bg-secondary);
  cursor: pointer; transition: background 0.15s, opacity 0.2s;
}
.action-item:hover { background: var(--accent-light); }
.action-item.checked { opacity: 0.55; }
.action-item.checked .action-text { text-decoration: line-through; }
.action-check { flex-shrink: 0; margin-top: 2px; color: var(--text-muted); font-size: 16px; }
.action-item.checked .action-check { color: var(--success); }
.action-text { flex: 1; }
.action-progress {
  display: flex; align-items: center; gap: 10px; margin-bottom: 12px;
  font-size: 12px; color: var(--text-muted);
}
.action-progress-bar {
  flex: 1; height: 6px; border-radius: 3px; background: var(--border); overflow: hidden;
}
.action-progress-fill {
  height: 100%; border-radius: 3px; background: var(--success);
  transition: width 0.3s ease;
}
.copy-btn {
  font-size: 11px; color: var(--text-muted); cursor: pointer;
  padding: 2px 8px; border: 1px solid var(--border); border-radius: 4px;
  background: transparent; transition: all 0.15s; white-space: nowrap;
}
.copy-btn:hover { background: var(--accent); color: #fff; border-color: var(--accent); }
.copy-btn.copied { background: var(--success); color: #fff; border-color: var(--success); }

/* Options Table */
.options-grid { display: flex; flex-direction: column; gap: 10px; }
.option-card {
  padding: 16px; border: 1px solid var(--border); border-radius: var(--radius);
  background: var(--bg-card);
}
.option-name { font-weight: 700; font-size: 15px; margin-bottom: 6px; }
.option-desc { font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; }
.option-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 12px; }
.option-tag {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 8px; border-radius: 4px; background: var(--bg-secondary);
  color: var(--text-secondary);
}

/* Risks */
.risk-item {
  padding: 14px 16px; border-left: 3px solid var(--danger);
  background: var(--bg-secondary); border-radius: 0 8px 8px 0;
  margin-bottom: 10px;
}
.risk-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
.risk-desc { font-size: 13px; color: var(--text-secondary); }

/* Subtitle */
.subtitle {
  font-size: 18px; color: var(--text-secondary); font-weight: 400;
  line-height: 1.5; margin-bottom: 12px;
}

/* Metrics Table */
.metrics-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.metrics-table th, .metrics-table td {
  padding: 8px 12px; text-align: center; border-bottom: 1px solid var(--border);
}
.metrics-table th { font-weight: 600; font-size: 12px; color: var(--text-muted); text-transform: uppercase; }
.metrics-table th.sortable { cursor: pointer; user-select: none; transition: color 0.15s; }
.metrics-table th.sortable:hover { color: var(--accent); }
.metrics-table th .sort-icon { font-size: 10px; margin-left: 2px; opacity: 0.4; }
.metrics-table th.sorted .sort-icon { opacity: 1; color: var(--accent); }
.metrics-table td:first-child { text-align: left; font-weight: 500; color: var(--text); }
.metrics-table .subject-col { background: var(--accent-light); font-weight: 700; color: var(--accent); }
.metrics-table th.subject-col { background: var(--accent-light); color: var(--accent); }
.metrics-table tbody tr:not(.metric-note) { transition: background 0.12s; }
.metrics-table tbody tr:not(.metric-note):hover { background: var(--accent-light); }
.metrics-table .best-val { color: var(--success); font-weight: 700; }
.metrics-table .metric-note td {
  text-align: left; font-size: 11px; color: var(--text-muted); font-style: italic;
  padding: 2px 12px 8px; border-bottom: 1px solid var(--border);
}
.metrics-footnote {
  font-size: 11px; color: var(--text-muted); font-style: italic;
  margin-top: 8px; padding: 0 4px;
}

/* Sources */
.source-list { font-size: 13px; }
.source-item {
  padding: 10px 0; border-bottom: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 4px;
}
.source-item:last-child { border-bottom: none; }
.source-title a { color: var(--accent); text-decoration: none; font-weight: 500; }
.source-title a:hover { text-decoration: underline; }
.source-meta { color: var(--text-muted); font-size: 12px; }
.source-excerpt { color: var(--text-secondary); font-size: 13px; font-style: italic; }

/* Collapsible */
.collapsible-trigger {
  width: 100%; text-align: left; background: none; border: none;
  cursor: pointer; color: var(--text); font: inherit;
  display: flex; align-items: center; gap: 6px;
}
.collapsible-trigger .arrow {
  display: inline-block; transition: transform 0.2s; font-size: 12px;
}
.collapsible-trigger[aria-expanded="true"] .arrow { transform: rotate(90deg); }
.collapsible-content { overflow: hidden; transition: max-height 0.3s ease; max-height: 0; }

/* Share Section */
.share-section {
  margin-top: 32px; padding: 20px; border-radius: var(--radius);
  background: var(--bg-secondary); border: 1px solid var(--border);
}
.share-buttons { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
.share-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
  border: 1px solid var(--border); background: var(--bg-card); color: var(--text);
  cursor: pointer; transition: all 0.15s; text-decoration: none;
}
.share-btn:hover { border-color: var(--accent); color: var(--accent); transform: translateY(-1px); box-shadow: var(--shadow); }
.share-btn.copied { background: var(--success); color: #fff; border-color: var(--success); }

/* Footer */
.footer {
  text-align: center; font-size: 12px; color: var(--text-muted);
  margin-top: 48px; padding-top: 24px; border-top: 1px solid var(--border);
}

/* Bilingual toggle */
[data-lang="zh"] [data-content="en"] { display: none; }
[data-lang="en"] [data-content="zh"] { display: none; }

/* Responsive */
@media (max-width: 640px) {
  .container { padding: 16px 12px 60px; }
  h1 { font-size: 22px; }
  .controls { gap: 4px; }
  .toggle-btn { padding: 5px 10px; font-size: 12px; }
  .option-meta { flex-direction: column; gap: 6px; }
}
</style>
</head>
<body>
<div class="container">
  <!-- Controls -->
  <div class="controls">
    <button class="toggle-btn active" id="lang-en" onclick="setLang('en')">EN</button>
    <button class="toggle-btn" id="lang-zh" onclick="setLang('zh')">‰∏≠Êñá</button>
    <span style="flex:1"></span>
    <button class="toggle-btn" id="theme-toggle" onclick="toggleTheme()">
      <span id="theme-icon">üåô</span>
    </button>
  </div>

  <!-- Header / Hero Poster Zone -->
  <header class="header">
    <div class="hero">
      <div class="hero-brand">
        <span class="hero-brand-name">AI Hotspot Daily</span>
        <span>{{meta.date}}</span>
      </div>
      <div data-content="zh">
        <div class="hero-body">
          <div class="hero-content">
            <h1>{{zh.title}}</h1>
            <p class="subtitle">{{zh.subtitle}}</p>
            <div class="tldr">{{zh.tldr}}</div>
          </div>
          <div class="hero-side {{confidence_class}}">
            <div class="confidence-ring" data-value="{{meta.confidence}}" style="position:relative">
              <svg width="56" height="56" viewBox="0 0 36 36">
                <circle class="ring-bg" cx="18" cy="18" r="15"/>
                <circle class="ring-fill" cx="18" cy="18" r="15"/>
              </svg>
              <span class="ring-text">{{meta.confidence}}%</span>
            </div>
            <span class="confidence-label" data-content="zh">ÁΩÆ‰ø°Â∫¶</span>
            <div class="hero-mini-metrics">{{zh.heroMetrics}}</div>
          </div>
        </div>
      </div>
      <div data-content="en">
        <div class="hero-body">
          <div class="hero-content">
            <h1>{{en.title}}</h1>
            <p class="subtitle">{{en.subtitle}}</p>
            <div class="tldr">{{en.tldr}}</div>
          </div>
          <div class="hero-side {{confidence_class}}">
            <div class="confidence-ring" data-value="{{meta.confidence}}" style="position:relative">
              <svg width="56" height="56" viewBox="0 0 36 36">
                <circle class="ring-bg" cx="18" cy="18" r="15"/>
                <circle class="ring-fill" cx="18" cy="18" r="15"/>
              </svg>
              <span class="ring-text">{{meta.confidence}}%</span>
            </div>
            <span class="confidence-label" data-content="en">Confidence</span>
            <div class="hero-mini-metrics">{{en.heroMetrics}}</div>
          </div>
        </div>
      </div>
      <div class="hero-cta">
        <span data-content="zh">&#9660; ÁªßÁª≠ÈòÖËØªÂÆåÊï¥ÂàÜÊûê</span>
        <span data-content="en">&#9660; Continue reading full analysis</span>
      </div>
    </div>
    <div class="meta-bar" style="margin-top:12px">
      <span class="date">{{meta.date}}</span>
      <span>¬∑</span>
      <span>{{meta.sourceCount}} sources</span>
    </div>
  </header>

  <!-- What Happened -->
  <div class="section">
    <div class="section-title" data-content="zh">ÂèëÁîü‰∫Ü‰ªÄ‰πà</div>
    <div class="section-title" data-content="en">What Happened</div>
    <div class="card">
      <div class="card-content" data-content="zh">{{zh.whatHappened}}</div>
      <div class="card-content" data-content="en">{{en.whatHappened}}</div>
    </div>
  </div>

  <!-- Key Metrics (if present) -->
  {{metrics_section}}

  <!-- Why It Matters -->
  <div class="section">
    <div class="section-title" data-content="zh">‰∏∫‰ªÄ‰πàÈáçË¶Å</div>
    <div class="section-title" data-content="en">Why It Matters</div>
    <div class="card">
      <div class="card-content" data-content="zh">{{zh.whyItMatters}}</div>
      <div class="card-content" data-content="en">{{en.whyItMatters}}</div>
    </div>
  </div>

  <!-- Who Is Affected -->
  <div class="section">
    <div class="section-title" data-content="zh">ÂèóÂΩ±ÂìçÁæ§‰Ωì</div>
    <div class="section-title" data-content="en">Who Is Affected</div>
    <div class="group-list" data-content="zh">{{zh.whoIsAffected}}</div>
    <div class="group-list" data-content="en">{{en.whoIsAffected}}</div>
  </div>

  <!-- What To Do -->
  <div class="section">
    <div class="section-title" data-content="zh">
      ‰Ω†ËØ•ÂÅö‰ªÄ‰πà
      <button class="copy-btn" onclick="copyAllActions('zh')" id="copy-all-zh">Â§çÂà∂ÂÖ®ÈÉ®</button>
    </div>
    <div class="section-title" data-content="en">
      What To Do
      <button class="copy-btn" onclick="copyAllActions('en')" id="copy-all-en">Copy All</button>
    </div>

    <div class="action-progress" data-content="zh">
      <span class="action-progress-label">ËøõÂ∫¶</span>
      <div class="action-progress-bar"><div class="action-progress-fill" style="width:0%"></div></div>
      <span class="action-progress-count">0/0</span>
    </div>
    <div class="action-progress" data-content="en">
      <span class="action-progress-label">Progress</span>
      <div class="action-progress-bar"><div class="action-progress-fill" style="width:0%"></div></div>
      <span class="action-progress-count">0/0</span>
    </div>

    <div data-content="zh">{{zh.whatToDo}}</div>
    <div data-content="en">{{en.whatToDo}}</div>
  </div>

  <!-- Options (if present) -->
  {{options_section}}

  <!-- Risks -->
  <div class="section">
    <div class="section-title" data-content="zh">È£éÈô©‰∏éËØØÂå∫</div>
    <div class="section-title" data-content="en">Risks & Pitfalls</div>
    <div data-content="zh">{{zh.risks}}</div>
    <div data-content="en">{{en.risks}}</div>
  </div>

  <!-- Sources -->
  <div class="section">
    <button class="collapsible-trigger" aria-expanded="false" onclick="toggleCollapse(this)">
      <span class="arrow">‚ñ∂</span>
      <span class="section-title" style="margin-bottom:0" data-content="zh">Êù•Ê∫ê ({{meta.sourceCount}})</span>
      <span class="section-title" style="margin-bottom:0" data-content="en">Sources ({{meta.sourceCount}})</span>
    </button>
    <div class="collapsible-content">
      <div class="source-list" data-content="zh" style="margin-top:12px">{{zh.sources}}</div>
      <div class="source-list" data-content="en" style="margin-top:12px">{{en.sources}}</div>
    </div>
  </div>

  <!-- Share -->
  <div class="share-section" id="share-section"
    data-title-zh="{{zh.title}}"
    data-title-en="{{en.title}}"
    data-tldr-zh="{{zh.tldr_short}}"
    data-tldr-en="{{en.tldr_short}}">
    <div class="section-title" data-content="zh" style="margin-bottom:4px">ÂàÜ‰∫´ËøôÁØáÂàÜÊûê</div>
    <div class="section-title" data-content="en" style="margin-bottom:4px">Share This Analysis</div>
    <div class="share-buttons">
      <a class="share-btn" id="share-x" target="_blank" rel="noopener noreferrer">&#120143; / Twitter</a>
      <a class="share-btn" id="share-reddit" target="_blank" rel="noopener noreferrer">Reddit</a>
      <a class="share-btn" id="share-linkedin" target="_blank" rel="noopener noreferrer">LinkedIn</a>
      <button class="share-btn" id="share-copy" onclick="copyShareText()">
        <span data-content="zh">Â§çÂà∂ÈìæÊé•</span>
        <span data-content="en">Copy Link</span>
      </button>
    </div>
  </div>

  <footer class="footer">
    <p>Generated by Hotspot Daily ¬∑ {{meta.date}} ¬∑ {{meta.generatedAt}}</p>
  </footer>
</div>

<script>
function setLang(lang) {
  document.documentElement.setAttribute('data-lang', lang);
  document.getElementById('lang-zh').classList.toggle('active', lang === 'zh');
  document.getElementById('lang-en').classList.toggle('active', lang === 'en');
  localStorage.setItem('hotspot-lang', lang);
}

function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  document.getElementById('theme-icon').textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('hotspot-theme', next);
}

function toggleCollapse(trigger) {
  const content = trigger.nextElementSibling;
  const expanded = trigger.getAttribute('aria-expanded') === 'true';
  trigger.setAttribute('aria-expanded', String(!expanded));
  if (expanded) {
    // Collapse: snapshot current height, force reflow, then animate to 0
    content.style.maxHeight = content.scrollHeight + 'px';
    content.offsetHeight; // force reflow
    content.style.maxHeight = '0';
  } else {
    // Expand: animate to scrollHeight, then set to 'none' so content adapts to resize
    content.style.maxHeight = content.scrollHeight + 'px';
    content.addEventListener('transitionend', function handler() {
      if (trigger.getAttribute('aria-expanded') === 'true') {
        content.style.maxHeight = 'none';
      }
      content.removeEventListener('transitionend', handler);
    });
  }
}

function copyText(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    const orig = btn.textContent;
    btn.textContent = '‚úì';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1500);
  });
}

function copyAllActions(lang) {
  const container = document.querySelector('[data-content="' + lang + '"] .action-text, [data-content="' + lang + '"]');
  const items = document.querySelectorAll('[data-content="' + lang + '"] .action-text');
  const text = Array.from(items).map(el => '- ' + el.textContent.trim()).join('\n');
  const btn = document.getElementById('copy-all-' + lang);
  copyText(text, btn);
}

// Share buttons
function initShareButtons() {
  var section = document.getElementById('share-section');
  if (!section) return;
  var url = location.href;
  var lang = document.documentElement.getAttribute('data-lang') || 'en';
  var title = section.getAttribute('data-title-' + lang) || section.getAttribute('data-title-en') || '';
  var tldr = section.getAttribute('data-tldr-' + lang) || section.getAttribute('data-tldr-en') || '';

  var xText = encodeURIComponent(title + '\n\n' + tldr + '\n\n#AIHotspotDaily');
  document.getElementById('share-x').href =
    'https://twitter.com/intent/tweet?text=' + xText + '&url=' + encodeURIComponent(url);

  document.getElementById('share-reddit').href =
    'https://www.reddit.com/submit?url=' + encodeURIComponent(url) + '&title=' + encodeURIComponent(title);

  document.getElementById('share-linkedin').href =
    'https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(url);
}

function copyShareText() {
  var btn = document.getElementById('share-copy');
  navigator.clipboard.writeText(location.href).then(function() {
    btn.classList.add('copied');
    var spans = btn.querySelectorAll('span');
    spans.forEach(function(s) { s.style.display = 'none'; });
    var checkSpan = document.createElement('span');
    checkSpan.textContent = '\u2713 Copied';
    btn.appendChild(checkSpan);
    setTimeout(function() {
      btn.classList.remove('copied');
      btn.removeChild(checkSpan);
      spans.forEach(function(s) { s.style.display = ''; });
    }, 1500);
  });
}

// Checkable action list
function initCheckableActions() {
  var slug = document.querySelector('meta[name="description"]') ?
    location.pathname.split('/').pop() || 'hotspot' : 'hotspot';
  var storageKey = 'hotspot-actions-' + slug;
  var checked = {};
  try { checked = JSON.parse(localStorage.getItem(storageKey)) || {}; } catch(e) {}

  var items = document.querySelectorAll('.action-item');
  items.forEach(function(item, idx) {
    item.setAttribute('data-action-idx', idx);
    if (checked[idx]) {
      item.classList.add('checked');
      item.querySelector('.action-check').innerHTML = '&#9745;';
    }
    item.addEventListener('click', function() {
      var isChecked = item.classList.toggle('checked');
      item.querySelector('.action-check').innerHTML = isChecked ? '&#9745;' : '&#9744;';
      checked[idx] = isChecked || undefined;
      if (!isChecked) delete checked[idx];
      try { localStorage.setItem(storageKey, JSON.stringify(checked)); } catch(e) {}
      updateActionProgress();
    });
  });
  updateActionProgress();
}

function updateActionProgress() {
  ['zh', 'en'].forEach(function(lang) {
    var container = document.querySelector('[data-content="' + lang + '"] .action-list');
    if (!container) return;
    var parent = container.closest('[data-content="' + lang + '"]');
    var allItems = parent.querySelectorAll('.action-item');
    var checkedItems = parent.querySelectorAll('.action-item.checked');
    var total = allItems.length;
    var done = checkedItems.length;
    var pct = total > 0 ? (done / total * 100) : 0;
    var progressBar = document.querySelector('.action-progress[data-content="' + lang + '"]');
    if (progressBar) {
      progressBar.querySelector('.action-progress-fill').style.width = pct + '%';
      progressBar.querySelector('.action-progress-count').textContent = done + '/' + total;
    }
  });
}

// Confidence ring animation
function initConfidenceRings() {
  document.querySelectorAll('.confidence-ring').forEach(function(ring) {
    var value = parseInt(ring.getAttribute('data-value'), 10) || 0;
    var circumference = 2 * Math.PI * 15; // r=15
    var offset = circumference * (1 - value / 100);
    var fill = ring.querySelector('.ring-fill');
    // Trigger animation after a short delay
    setTimeout(function() {
      fill.style.strokeDashoffset = offset;
    }, 100);
  });
}

// Sortable metrics table
function initSortableTables() {
  document.querySelectorAll('.metrics-table').forEach(function(table) {
    var headers = table.querySelectorAll('th');
    headers.forEach(function(th, colIdx) {
      if (colIdx === 0) return; // skip metric name column
      th.classList.add('sortable');
      th.innerHTML += ' <span class="sort-icon">&#9650;</span>';
      th.addEventListener('click', function() {
        sortTable(table, colIdx, th);
      });
    });
    highlightBestValues(table);
  });
}

function parseNumeric(text) {
  var match = text.match(/([\d.]+)\s*([KMBkmb])?/);
  if (!match) return null;
  var num = parseFloat(match[1]);
  if (isNaN(num)) return null;
  var suffix = (match[2] || '').toUpperCase();
  if (suffix === 'K') num *= 1000;
  else if (suffix === 'M') num *= 1000000;
  else if (suffix === 'B') num *= 1000000000;
  return num;
}

function sortTable(table, colIdx, clickedTh) {
  var tbody = table.querySelector('tbody');
  var rows = Array.from(tbody.querySelectorAll('tr:not(.metric-note)'));
  var noteRows = Array.from(tbody.querySelectorAll('tr.metric-note'));
  var asc = clickedTh.getAttribute('data-sort') !== 'asc';
  table.querySelectorAll('th').forEach(function(h) {
    h.classList.remove('sorted');
    h.removeAttribute('data-sort');
  });
  clickedTh.classList.add('sorted');
  clickedTh.setAttribute('data-sort', asc ? 'asc' : 'desc');
  clickedTh.querySelector('.sort-icon').innerHTML = asc ? '&#9650;' : '&#9660;';
  rows.sort(function(a, b) {
    var aVal = parseNumeric(a.cells[colIdx].textContent);
    var bVal = parseNumeric(b.cells[colIdx].textContent);
    if (aVal === null && bVal === null) return 0;
    if (aVal === null) return 1;
    if (bVal === null) return -1;
    return asc ? aVal - bVal : bVal - aVal;
  });
  rows.forEach(function(row) { tbody.appendChild(row); });
  noteRows.forEach(function(row) { tbody.appendChild(row); });
}

function highlightBestValues(table) {
  var rows = Array.from(table.querySelectorAll('tbody tr:not(.metric-note)'));
  if (rows.length === 0) return;
  var colCount = rows[0].cells.length;
  var metricLabels = rows.map(function(r) { return r.cells[0].textContent.toLowerCase(); });
  for (var c = 1; c < colCount; c++) {
    // Skip: best value highlight is per-row across models, not per-column
  }
  rows.forEach(function(row) {
    var label = row.cells[0].textContent.toLowerCase();
    var lowerIsBetter = /price|‰ª∑Ê†º|cost|ÊàêÊú¨|latency|Âª∂Ëøü/.test(label);
    var vals = [];
    for (var c = 1; c < row.cells.length; c++) {
      vals.push({ idx: c, val: parseNumeric(row.cells[c].textContent) });
    }
    vals = vals.filter(function(v) { return v.val !== null; });
    if (vals.length < 2) return;
    vals.sort(function(a, b) { return lowerIsBetter ? a.val - b.val : b.val - a.val; });
    row.cells[vals[0].idx].classList.add('best-val');
  });
}

// Restore preferences
(function() {
  const savedTheme = localStorage.getItem('hotspot-theme');
  const savedLang = localStorage.getItem('hotspot-lang');
  if (savedTheme) {
    document.documentElement.setAttribute('data-theme', savedTheme);
    document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  }
  if (savedLang) setLang(savedLang);
  initSortableTables();
  initConfidenceRings();
  initCheckableActions();
  initShareButtons();
})();
</script>
</body>
</html>
